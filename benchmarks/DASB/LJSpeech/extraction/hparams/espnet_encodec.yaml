# ############################################################################
# Auido Tokenizer: Encodec
# Extraction: Librispeech 960h
# Authors: Jarod Duret 2024
# ############################################################################
# Seed needs to be set at top of yaml, before objects with parameters are made

seed: 1986
__set_seed: !apply:torch.manual_seed [!ref <seed>]
output_folder: !ref results/encodec
save_folder: !ref <output_folder>/save
pretrained_model_save_folder: !ref <save_folder>
train_log: !ref <output_folder>/extraction_log.txt

# Data files
data_folder: !PLACEHOLDER  # e.g., /path/to/LJSpeech
splits: ["train", "valid", "test"]
split_ratio: [90, 5, 5]
frozen_split_path: null
skip_prep: False
train_json: !ref <output_folder>/train.json
valid_json: !ref <output_folder>/valid.json
test_json: !ref <output_folder>/test.json


batch_size: 8
num_workers: 8
src_key: wav
id_key: id

# Dataloader options
dataloader_opts:
  batch_size: !ref <batch_size>
  shuffle: True
  num_workers: !ref <num_workers>

# EnCodec parameters
# sample_rate: [24000, 24000, 24000, 24000]
# vocab_size: [1024, 1024, 1024, 1024]
# bandwidth: [1.5, 3.0, 6.0, 12.0, 24.0]
# num_codebooks: [2, 4, 8, 16, 32]
espnet_repo: https://github.com/espnet/espnet
espnet_commit: 1974048563d7c57e11f670d24bac8fb4b5aba4ef
model_hub: espnet/libritts_encodec_24k
model_ckpt: exp/codec_encodec_ss4_24k/120epoch.pth
model_config: exp/codec_encodec_ss4_24k/config.yaml
num_codebooks: 32
vocab_size: 1024
sample_rate: 24000
save_embedding: False

tokenizer: !new:utils.tokenizer_interface.ESPNetEncodecInterface
  source: !ref <model_hub>
  model_config: !ref <model_config>
  n_codebook: !ref <num_codebooks>
  save_path: !ref <pretrained_model_save_folder>
  sample_rate: !ref <sample_rate>
  model_ckpt: !ref <model_ckpt>
  espnet_commit: !ref <espnet_commit>

tokens_extractor: !new:utils.tokens.TokensExtractor
  tokenizer: !ref <tokenizer>
  sample_rate: !ref <sample_rate>
  src_key: !ref <src_key>
  id_key: !ref <id_key>
  dataloader_opts: !ref <dataloader_opts>
